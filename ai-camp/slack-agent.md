# Slack Agent 使い方ガイド

> 本ドキュメントは、`claude-agent-sdk` プロジェクトにおける Slack Bot（エージェントルーター）の仕組みと、現在利用可能な各エージェントの使い方をまとめたものです。

![Slack Agent Architecture](slack-agent.png)

---

## 1. 全体アーキテクチャ（フロントエージェント）

Slack Botは、ユーザーからのメンションを受け取ると、まず**フロントエージェント**がメッセージの意図を分類し、適切なバックエンドエージェントにタスクを振り分けます（ルーティング）。

### フロントエージェントの役割

- **意図分類**: ユーザーのメッセージから「リサーチ」か「台本作成」か、あるいは「雑談」かを判断します。
- **見積もりの提示**: タスクを実行する前に、過去の実行履歴（`history.json`）から算出した「予想時間」と「予想コスト」をSlack上で提示し、ユーザーの承認（「はい」「よろしく」など）を待ちます。
- **Human-in-the-loop (HITL)**: 途中でユーザーの確認や選択が必要な場合、Slackのスレッド上で対話しながらタスクを進めます。

### 基本的な使い方

Slack上でBot宛にメンション（`@agent tester` など）をつけてメッセージを送信するだけです。

**【Slackでの起動方法】**

1. Slackのサイドバーから「App」または「アプリ」を選択します。
2. **`agent tester`** を検索して開きます。
3. メッセージ入力欄から、直接Botに話しかけるか、メンションをつけて依頼を送信します。

![Slack App Selection](agent-tester.png)

```text
@agent tester 次の台本を作って
@agent tester Instagramのリールのトレンドを調べて
```

---

## 2. 利用可能なエージェント

現在、以下の2つのバックエンドエージェントが稼働しています。

### 2.1 `research` エージェント（SNS・SEOリサーチ）

指定されたトピックについて、Web検索を行い、最新のトレンドや情報をまとめたレポート（Markdown形式）を作成します。

- **得意なこと**: SNSトレンド調査、SEOキーワード調査、競合分析など。
- **起動キーワード例**: 「調べて」「リサーチ」「トレンド」「分析して」「調査」
- **目安時間**: 約5〜15分
- **目安コスト**: 約30〜70円

**【使用例】**

> **ユーザー**: `@AgentBot 2025年のInstagramリールのトレンドを調べて`
> **Bot**: `📊 research-agent を起動しますか？ トピック: 2025年のInstagramリールのトレンド (予想: 5〜15分 / 約30〜70円)`
> **ユーザー**: `はい`
> _(数分後)_
> **Bot**: `✅ リサーチが完了しました！` (Markdownファイルが添付される)

---

### 2.2 `mk_draft` エージェント（SNS台本作成）

過去の台本データ（Googleスプレッドシート）を読み込み、最新のトレンドを踏まえた上で、新しいSNS台本の案を複数作成し、ユーザーと対話しながら最終的な台本を完成させます。

- **得意なこと**: 過去のトーン＆マナーを踏襲した台本作成、複数案の提示とブラッシュアップ。
- **起動キーワード例**: 「台本」「投稿」「スクリプト」「企画」「コンテンツ作成」
- **目安時間**: 約5〜10分
- **目安コスト**: 約10〜30円

**【使用例（HITLワークフロー）】**
このエージェントは、途中でユーザーの確認を挟む「Human-in-the-loop」形式で動作します。

1. **起動とデータ読み込み**

   > **ユーザー**: `@AgentBot 次の台本を作って`
   > **Bot**: `📝 mk_draft-agent を起動しますか？`
   > **ユーザー**: `よろしく`
   > **Bot**: _(スプレッドシートから過去データを読み込み、トレンドを調査中...)_

2. **複数案の提示（Proposals）**

   > **Bot**: `💡 以下の4つの台本案を作成しました。どの案で進めますか？（1〜4の番号で答えてください）`
   > _(案1〜4のタイトルと概要が提示される)_
   > **ユーザー**: `2番でお願いします。もう少しポップな感じにして。`

3. **台本の生成とレビュー（Review）**

   > **Bot**: _(2番の案を元に、ポップなトーンでフル台本を生成中...)_
   > **Bot**: `📝 台本を作成しました。内容を確認してください。修正があれば指示を、これで良ければ「確定」と返信してください。`
   > _(生成された台本テキストが提示される)_
   > **ユーザー**: `冒頭の挨拶を「こんにちは！」に変えて`
   > **Bot**: _(修正版の台本を再提示)_
   > **ユーザー**: `確定`

4. **完了と保存**

   > **Bot**: `✅ 台本が確定しました！スプレッドシートに保存しました。` (最終版のMarkdownファイルも添付される)

---

## 3. エージェントの追加・カスタマイズについて

新しいエージェントを追加する場合は、`document/agent-creation-guide.md` の規約に従って `agents/` ディレクトリに新しいモジュールを作成し、`slack_bot/main.py` のフロントエージェント（`ROUTING_SYSTEM` プロンプトとルーティング処理）を更新してください。
